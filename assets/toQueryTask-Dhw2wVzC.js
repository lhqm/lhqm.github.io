import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang-J-klaX4f.js";import{a as p,p as k,o as c,c as E,w as t,f as g,r as a,g as i,h as s}from"./app-bSrHFPqN.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-DnhrUQyh.js";import"./YunCard.vue_vue_type_script_setup_true_lang-CPynrbxK.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-Bs409l9f.js";import"./index-C7yU5XnD.js";const u=i("h2",{id:"前言",tabindex:"-1"},[s("前言 "),i("a",{class:"header-anchor",href:"#前言","aria-label":'Permalink to "前言"'},"​")],-1),y=i("p",null,"这是工作流模块第一篇记录，但是不一定在将来会作为第一篇入手文章以面向更多的读者。",-1),m=i("p",null,[s("此篇记录的主要目的是关于如何获取"),i("code",null,"activiti 7某个流程定义的用户任务信息"),s("。")],-1),_=i("h2",{id:"获取目的",tabindex:"-1"},[s("获取目的 "),i("a",{class:"header-anchor",href:"#获取目的","aria-label":'Permalink to "获取目的"'},"​")],-1),v=i("p",null,"这篇文章的出现比较突兀。我并没有介绍activiti，而是直接跳到了自动化流程部署的相关内容。",-1),f=i("p",null,[s("这个流程系统的本质是"),i("code",null,"流程中台"),s("，用于"),i("code",null,"其他业务系统或OA系统"),s("远程推送部署实例到本流程中台，然后通过本流程中台去驱动其他业务系统的状态。")],-1),F=i("p",null,"看到这里我们不妨思考几个问题:",-1),D=i("ol",null,[i("li",null,[s("在工作流系统的辅助下，交互系统（或租户系统）"),i("code",null,"从一个状态驱动到另一个状态"),s("，如何实现？")]),i("li",null,[s("如何将流程相关的业务"),i("strong",null,"全部托管"),s("给工作流系统，以实现业务解耦？")]),i("li",null,[s("如何在多租户模式下，更高效且优雅地通知客户端，告知"),i("code",null,"流程的相关设计组织形式"),s("，以及及时通知更改？")])],-1),b=i("p",null,[i("strong",null,"聪明的你会怎么做呢？")],-1),A=i("h2",{id:"从节点获取谈设计思路",tabindex:"-1"},[s("从节点获取谈设计思路 "),i("a",{class:"header-anchor",href:"#从节点获取谈设计思路","aria-label":'Permalink to "从节点获取谈设计思路"'},"​")],-1),C=i("p",null,"获取节点的目的是什么？我想这个是最直接也是最难以理解的一个问题。",-1),I=i("p",null,[s("首先谈任务处理这件事，事件处理我们最经常能想到的就是"),i("code",null,"状态机"),s("和"),i("code",null,"工作流引擎"),s("两种方式。")],-1),B=i("p",null,[i("strong",null,"什么是状态机？"),i("s",null,"还问这个问题的先叉出去"),s(",状态机就是类似我定义1是用户申请，2是系统审核，3是审核员审核，4是网站发布员审核，然后才到发布。")],-1),P=i("p",null,"因此去选择一个状态，往往你只需要将状态往线上动态字典里一加，然后根据动态字典的key按图索骥即可。",-1),$=i("p",null,[s("但是放到动态流程里呢？我也需要上述这样"),i("code",null,"<1,用户申请>"),s("的数据结构。而且这个结构需要可以"),i("code",null,"动态修改"),s("。")],-1),T=i("p",null,[s("那么很显然，我只需要把一个流程里边的相关节点数据取出来就行了，并且我只需要取"),i("code",null,"用户任务"),s("的流转节点。")],-1),w=i("p",null,[s("因为用户任务，才是"),i("code",null,"驱动状态更改的关键要素"),s("。")],-1),j=i("p",null,"现在我们明确了一条这样的路：",-1),x=i("blockquote",null,[i("ul",null,[i("li",null,"其他工作流驱动客户端需要全托管"),i("li",null,"完全驱动底层状态机来完成"),i("li",null,"状态机信息可以来自工作流定义"),i("li",null,"驱动状态机变迁的是用户任务"),i("li",null,"在工作流定义之中选择用户任务")])],-1),S=i("h2",{id:"实现",tabindex:"-1"},[s("实现 "),i("a",{class:"header-anchor",href:"#实现","aria-label":'Permalink to "实现"'},"​")],-1),M=i("blockquote",null,[i("p",null,"相关注释在代码中已经写明了，就不再赘述了")],-1),U=i("h3",{id:"代码展示",tabindex:"-1"},[s("代码展示 "),i("a",{class:"header-anchor",href:"#代码展示","aria-label":'Permalink to "代码展示"'},"​")],-1),R=i("div",{style:{"max-height":"400px"},class:"language-java vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"java"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RepositoryService repositoryService;")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Map"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"String,String"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getUserTaskByProcessDefinition"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String definitionId){")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//        获取到流程的模型实例")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        BpmnModel bpmnModel "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," repositoryService."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getBpmnModel"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(definitionId);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//        在模型的流程表里选择第一个流程作为流程对象定义（一般也只有一个）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Process process "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bpmnModel."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getProcesses"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//        返回数据，这里开始对流程信息进行解构，获取到所有用户任务。因为用户任务才能参与审核，审核才会唤醒流转，流转才会改变状态")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  process")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//                获取到所有流程节点")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getFlowElements"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//                转为stream流")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//                筛选出用户任务")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"filter"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(item "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," item "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," UserTask)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//                将筛选得到的任务包装为用户任务的对象类型")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(item "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (UserTask) item)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//                收集，转为map，得到流程的定义：名字和任务流转编号，以实现状态机驱动")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"collect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collectors."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toMap"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(UserTask"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"getId, UserTask"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"getName));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")])])]),i("button",{class:"collapse"})],-1),q=i("h3",{id:"流程定义id的由来",tabindex:"-1"},[s("流程定义ID的由来 "),i("a",{class:"header-anchor",href:"#流程定义id的由来","aria-label":'Permalink to "流程定义ID的由来"'},"​")],-1),N=i("p",null,[s("需要注意的是，"),i("code",null,"流程"),s("、"),i("code",null,"流程实例"),s("、"),i("code",null,"流程定义"),s("是三个东西。")],-1),Z=i("p",null,[s("可以这样理解："),i("code",null,"Integer id=666"),s("，Integer是一个"),i("code",null,"流程定义"),s("，因为这个流程定义，实际上可以Integer id，他也可以Integer age。但是你的id，类似是流程，他就是一个变量，可以消亡滴，他有自己的生命周期。")],-1),O=i("p",null,"那么666这个实例化的过程，实例化以后就是流程实例。",-1),Q=i("p",null,"实际场景中，我们可能大部分情况下都是只知道流程的id，可以从流程ID获得流程实例，然后再通过流程实例，取得流程的定义ID。",-1),V=i("p",null,"那么我们可以这样做：",-1),H=i("h4",{id:"注入流程运行时上下文",tabindex:"-1"},[s("注入流程运行时上下文 "),i("a",{class:"header-anchor",href:"#注入流程运行时上下文","aria-label":'Permalink to "注入流程运行时上下文"'},"​")],-1),L=i("div",{style:{"max-height":"400px"},class:"language-java vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"java"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ProcessRuntime processRuntime;")])])]),i("button",{class:"collapse"})],-1),J=i("h4",{id:"通过流程实例id逐步获取流程定义",tabindex:"-1"},[s("通过流程实例ID逐步获取流程定义 "),i("a",{class:"header-anchor",href:"#通过流程实例id逐步获取流程定义","aria-label":'Permalink to "通过流程实例ID逐步获取流程定义"'},"​")],-1),z=i("p",null,[s("流程的实例ID可以来源于很多地方，比如说："),i("code",null,"自己传入流程实例"),s("、"),i("code",null,"传入任务节点实例"),s("、"),i("code",null,"流程定义列表"),s("等等。")],-1),G=i("div",{style:{"max-height":"400px"},class:"language-java vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"java"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ProcessInstance processInstance "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," processRuntime."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"processInstance"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(task."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getProc_inst_id_"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String processDefinitionId "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," processInstance."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getProcessDefinitionId"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),i("button",{class:"collapse"})],-1),ei={__name:"toQueryTask",setup(K,{expose:o}){const e=JSON.parse('{"title":"Activiti 7获取用户审核任务节点","description":"","frontmatter":{"title":"Activiti 7获取用户审核任务节点","date":"2024-02-29T00:00:00.000Z","updated":"2024-02-29T00:00:00.000Z","categories":"工作流","codeHeightLimit":400,"tags":["activiti","java"]},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"获取目的","slug":"获取目的","link":"#获取目的","children":[]},{"level":2,"title":"从节点获取谈设计思路","slug":"从节点获取谈设计思路","link":"#从节点获取谈设计思路","children":[]},{"level":2,"title":"实现","slug":"实现","link":"#实现","children":[{"level":3,"title":"代码展示","slug":"代码展示","link":"#代码展示","children":[]},{"level":3,"title":"流程定义ID的由来","slug":"流程定义id的由来","link":"#流程定义id的由来","children":[]}]}],"relativePath":"pages/posts/workflow/toQueryTask.md","path":"/home/runner/work/lhqm.github.io/lhqm.github.io/pages/posts/workflow/toQueryTask.md","lastUpdated":1715585358000}'),h=p(),n=e.frontmatter||{};return h.meta.frontmatter=Object.assign(h.meta.frontmatter||{},e.frontmatter||{}),k("pageData",e),k("valaxy:frontmatter",n),globalThis.$frontmatter=n,o({frontmatter:{title:"Activiti 7获取用户审核任务节点",date:"2024-02-29T00:00:00.000Z",updated:"2024-02-29T00:00:00.000Z",categories:"工作流",codeHeightLimit:400,tags:["activiti","java"]}}),(l,X)=>{const r=d;return c(),E(r,{frontmatter:g(n)},{"main-content-md":t(()=>[u,y,m,_,v,f,F,D,b,A,C,I,B,P,$,T,w,j,x,S,M,U,R,q,N,Z,O,Q,V,H,L,J,z,G]),"main-header":t(()=>[a(l.$slots,"main-header")]),"main-header-after":t(()=>[a(l.$slots,"main-header-after")]),"main-nav":t(()=>[a(l.$slots,"main-nav")]),"main-content":t(()=>[a(l.$slots,"main-content")]),"main-content-after":t(()=>[a(l.$slots,"main-content-after")]),"main-nav-before":t(()=>[a(l.$slots,"main-nav-before")]),"main-nav-after":t(()=>[a(l.$slots,"main-nav-after")]),comment:t(()=>[a(l.$slots,"comment")]),footer:t(()=>[a(l.$slots,"footer")]),aside:t(()=>[a(l.$slots,"aside")]),"aside-custom":t(()=>[a(l.$slots,"aside-custom")]),default:t(()=>[a(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{ei as default};
